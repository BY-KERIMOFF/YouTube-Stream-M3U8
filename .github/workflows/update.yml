name: ðŸŽ¬ TR YouTube Stream Updater

on:
  schedule:
    # HÉ™r saat bir yenilÉ™
    - cron: '0 * * * *'
  
  workflow_dispatch:  # Æl ilÉ™ baÅŸlatma
  
  push:
    branches: [ main ]
    paths:
      - 'turkish.json'
      - 'main.py'
      - '.github/workflows/update.yml'

permissions:
  contents: write

jobs:
  update-streams:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Repository-ni gÃ¶tÃ¼r
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ðŸ Python quraÅŸdÄ±r
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ðŸ“¦ LazÄ±mlÄ± paketlÉ™ri yÃ¼klÉ™
        run: |
          python -m pip install --upgrade pip
          pip install requests
          pip install yt-dlp
          pip install cloudscraper
      
      - name: ðŸŽ¯ YouTube stream-lÉ™ri gÃ¶tÃ¼r
        id: get-streams
        run: |
          echo "ðŸ” YouTube canlÄ± yayÄ±nlarÄ± axtarÄ±lÄ±r..."
          python main.py
          
          # NÉ™ticÉ™ni yoxla
          if find TR -name "*.m3u8" | grep -q .; then
            echo "âœ… Stream-lÉ™r tapÄ±ldÄ±"
            echo "has_streams=true" >> $GITHUB_OUTPUT
            echo "YaradÄ±lan fayllar:"
            find TR -name "*.m3u8" | head -20
          else
            echo "âš  HeÃ§ bir stream tapÄ±lmadÄ±"
            echo "has_streams=false" >> $GITHUB_OUTPUT
          fi
      
      - name: ðŸ“Š DÉ™yiÅŸikliklÉ™ri yoxla
        if: steps.get-streams.outputs.has_streams == 'true'
        id: check-changes
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"
          
          git add TR/ || true
          
          if git diff --cached --quiet; then
            echo "ðŸ“­ Yeni dÉ™yiÅŸiklik yoxdur"
            echo "changes=false" >> $GITHUB_OUTPUT
          else
            echo "ðŸ“¬ Yeni dÉ™yiÅŸikliklÉ™r var"
            echo "changes=true" >> $GITHUB_OUTPUT
          fi
      
      - name: ðŸ’¾ DÉ™yiÅŸikliklÉ™ri commit et
        if: steps.get-streams.outputs.has_streams == 'true' && steps.check-changes.outputs.changes == 'true'
        run: |
          git commit -m "ðŸŽ¬ TR Stream-lÉ™r yenilÉ™ndi - $(date +'%Y-%m-%d %H:%M')"
      
      - name: ðŸš€ DÉ™yiÅŸikliklÉ™ri pushla
        if: steps.get-streams.outputs.has_streams == 'true' && steps.check-changes.outputs.changes == 'true'
        run: |
          git push
      
      - name: ðŸ“‹ NÉ™ticÉ™
        run: |
          echo "========================================"
          echo "ðŸŽ‰ TR YouTube Stream Updater TamamlandÄ±"
          echo "========================================"
          echo "Tarix: $(date)"
          echo "Stream-lÉ™r: ${{ steps.get-streams.outputs.has_streams }}"
          echo "DÉ™yiÅŸikliklÉ™r: ${{ steps.check-changes.outputs.changes }}"
          echo "TR qovluÄŸundakÄ± fayllar:"
          find TR -name "*.m3u8" 2>/dev/null | wc -l || echo "0"
          echo "========================================"
